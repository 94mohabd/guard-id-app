"use strict";(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[293],{3293:(w,p,l)=>{l.r(p),l.d(p,{SelfieComponent:()=>P});var m=l(467),f=l(5423),u=l(177),e=l(4438),v=l(3459),h=l(6354),I=l(9437),C=l(8810),b=l(1626);let x=(()=>{class r{constructor(i){this.http=i,this.apiBaseUrl="https://guardid-dugdbpembqa0ega6.centralus-01.azurewebsites.net/api/Detection"}uploadVerificationImages(i,t,n){const o=new FormData;return o.append("frontId",i),o.append("backId",t),o.append("selfie",n),this.http.post(`${this.apiBaseUrl}/verify-id`,o).pipe((0,h.T)(a=>({success:!0,message:"Upload successful",result:a})),(0,I.W)(a=>{let s={errorCode:"UNKNOWN_ERROR",message:"An unknown error occurred.",details:""};return a.error&&(s={errorCode:a.error.errorCode||"UNKNOWN_ERROR",message:a.error.message||"An error occurred.",details:a.error.details||""}),(0,C.$)(()=>({success:!1,message:s.message,error:s}))}))}static{this.\u0275fac=function(t){return new(t||r)(e.KVO(b.Qq))}}static{this.\u0275prov=e.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();const F=["fileInput"];function M(r,c){1&r&&(e.j41(0,"div",13)(1,"span",14),e.EFF(2,"face"),e.k0s(),e.j41(3,"div",15),e.nrm(4,"div",16)(5,"div",16)(6,"div",16)(7,"div",16),e.k0s()())}function y(r,c){1&r&&(e.j41(0,"div",17),e.EFF(1," Checking Image, please wait... "),e.nrm(2,"div",18),e.k0s())}function S(r,c){if(1&r&&(e.j41(0,"div",19)(1,"strong"),e.EFF(2,"Error: "),e.k0s(),e.EFF(3),e.k0s()),2&r){const i=e.XpG();e.R7$(3),e.SpI("",i.errorMessage," ")}}function O(r,c){if(1&r&&e.nrm(0,"img",20),2&r){const i=e.XpG();e.Y8G("src",i.previewUrl,e.B4B)}}function U(r,c){if(1&r){const i=e.RV6();e.j41(0,"div",21)(1,"button",22),e.bIt("click",function(){e.eBV(i);const n=e.XpG();return e.Njj(n.uploadPhoto())}),e.EFF(2),e.k0s()()}if(2&r){const i=e.XpG();e.R7$(),e.Y8G("disabled",i.isUploading),e.R7$(),e.SpI(" ",i.isUploading?"Uploading...":"Complete Verification"," ")}}function k(r,c){1&r&&(e.j41(0,"div",23)(1,"div",24),e.nrm(2,"div",18),e.j41(3,"p"),e.EFF(4,"Uploading your verification..."),e.k0s()()())}let P=(()=>{class r{constructor(i,t,n){this.imageVerificationService=i,this.uploadService=t,this.router=n,this.selectedFile=null,this.previewUrl=null,this.isLoading=!1,this.isUploading=!1,this.errorMessage=null,this.isValidated=!1}ngOnInit(){const i=localStorage.getItem("selfie");i&&(this.previewUrl=i,this.selectedFile=null,this.isValidated=!0)}triggerFileInput(){this.fileInput.nativeElement.click()}onFileSelected(i){var t=this;return(0,m.A)(function*(){const n=i.target;if(n.files&&n.files.length>0){t.selectedFile=n.files[0],t.errorMessage=null,t.isLoading=!0,t.isValidated=!1,t.previewUrl=null;try{const o=yield t.imageVerificationService.processSelfieImage(t.selectedFile);o.success?(t.previewUrl=o.previewUrl,t.selectedFile=o.resizedImage,t.isValidated=!0,localStorage.setItem("selfie",o.previewUrl)):(localStorage.removeItem("selfie"),t.errorMessage=o.message)}catch{t.errorMessage="Error processing image. Please try again."}finally{t.isLoading=!1}}})()}uploadPhoto(){if(this.isValidated&&!this.errorMessage){this.isUploading=!0,this.errorMessage=null;const i=localStorage.getItem("frontId"),t=localStorage.getItem("backId"),n=localStorage.getItem("selfie");if(!i||!t||!n)return this.errorMessage="Missing ID images. Please upload them again.",void(this.isUploading=!1);const o=this.dataURLtoFile(i,"frontId.jpg"),a=this.dataURLtoFile(t,"backId.jpg"),s=this.dataURLtoFile(n,"selfie.jpg"),g=this.uploadService.uploadVerificationImages(o,a,s).subscribe({next:d=>{d.success?(localStorage.setItem("verificationResult",JSON.stringify(d.result)),this.router.navigate(["/verification-result"])):this.errorMessage=d.message},error:d=>{this.errorMessage=d.message||"Error uploading images"},complete:()=>{this.isUploading=!1,g.unsubscribe()}})}}dataURLtoFile(i,t){const n=i.split(","),o=n[0].match(/:(.*?);/)?.[1],a=atob(n[1]);let s=a.length;const g=new Uint8Array(s);for(;s--;)g[s]=a.charCodeAt(s);return new File([g],t,{type:o})}static{this.\u0275fac=function(t){return new(t||r)(e.rXU(v.s),e.rXU(x),e.rXU(f.Ix))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-selfie"]],viewQuery:function(t,n){if(1&t&&e.GBs(F,5),2&t){let o;e.mGM(o=e.lsd())&&(n.fileInput=o.first)}},decls:20,vars:6,consts:[["fileInput",""],[1,"container","screen-enter"],[1,"header"],["routerLink","/id-upload-back",1,"back-button"],[1,"content"],[1,"upload-area",3,"click"],["class","selfie-placeholder",4,"ngIf"],["class","loading-message",4,"ngIf"],["class","error-message",4,"ngIf"],["alt","Selfie preview","class","preview-image",3,"src",4,"ngIf"],["type","file","accept","image/*",2,"display","none",3,"change"],["class","footer",4,"ngIf"],["class","loading-overlay",4,"ngIf"],[1,"selfie-placeholder"],[1,"material-icons"],[1,"placeholder-lines"],[1,"line"],[1,"loading-message"],[1,"spinner"],[1,"error-message"],["alt","Selfie preview",1,"preview-image",3,"src"],[1,"footer"],[1,"primary-button",3,"click","disabled"],[1,"loading-overlay"],[1,"loading-content"]],template:function(t,n){if(1&t){const o=e.RV6();e.j41(0,"div",1)(1,"div",2)(2,"a",3),e.EFF(3,"\u2190"),e.k0s()(),e.j41(4,"div",4)(5,"h2"),e.EFF(6,"Take a Selfie"),e.k0s(),e.j41(7,"p"),e.EFF(8,"Make sure you're well-lit"),e.nrm(9,"br"),e.EFF(10,"and facing the camera."),e.k0s(),e.j41(11,"div",5),e.bIt("click",function(){return e.eBV(o),e.Njj(n.triggerFileInput())}),e.DNE(12,M,8,0,"div",6)(13,y,3,0,"div",7)(14,S,4,1,"div",8)(15,O,1,1,"img",9),e.j41(16,"input",10,0),e.bIt("change",function(s){return e.eBV(o),e.Njj(n.onFileSelected(s))}),e.k0s()()(),e.DNE(18,U,3,2,"div",11)(19,k,5,0,"div",12),e.k0s()}2&t&&(e.R7$(12),e.Y8G("ngIf",!n.selectedFile&&!n.previewUrl),e.R7$(),e.Y8G("ngIf",n.isLoading),e.R7$(),e.Y8G("ngIf",n.errorMessage),e.R7$(),e.Y8G("ngIf",n.previewUrl),e.R7$(3),e.Y8G("ngIf",n.isValidated&&!n.errorMessage),e.R7$(),e.Y8G("ngIf",n.isUploading))},dependencies:[f.Wk,u.bT],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;padding:var(--spacing-lg);position:relative}.header[_ngcontent-%COMP%]{padding:var(--spacing-md) 0}.content[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column;align-items:center;padding-top:var(--spacing-xl);text-align:center}h2[_ngcontent-%COMP%]{font-size:24px;margin-bottom:var(--spacing-md)}p[_ngcontent-%COMP%]{color:#666;margin-bottom:var(--spacing-xl)}.upload-area[_ngcontent-%COMP%]{border:2px dashed var(--border-color);border-radius:var(--border-radius-md);padding:var(--spacing-xl);width:100%;height:200px;display:flex;align-items:center;justify-content:center;margin:var(--spacing-lg) 0;cursor:pointer;position:relative}.selfie-placeholder[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;color:#aaa}.selfie-placeholder[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:48px;margin-bottom:var(--spacing-md)}.placeholder-lines[_ngcontent-%COMP%]{width:120px}.line[_ngcontent-%COMP%]{height:8px;background-color:var(--medium-gray);margin-bottom:8px;border-radius:4px}.loading-message[_ngcontent-%COMP%]{color:var(--primary-color);text-align:center}.spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid var(--primary-color);border-top-color:transparent;border-radius:50%;margin:10px auto;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-message[_ngcontent-%COMP%]{color:#dc3545;text-align:center;margin-top:var(--spacing-md)}.preview-image[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain}.footer[_ngcontent-%COMP%]{padding:var(--spacing-lg) 0}.primary-button[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.loading-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#ffffffe6;display:flex;justify-content:center;align-items:center;z-index:1000}.loading-content[_ngcontent-%COMP%]{text-align:center;padding:var(--spacing-xl);background-color:#fff;border-radius:var(--border-radius-md);box-shadow:0 2px 10px #0000001a}.loading-content[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:3px solid var(--primary-color);border-top-color:transparent;border-radius:50%;margin:0 auto 20px;animation:_ngcontent-%COMP%_spin 1s linear infinite}.loading-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--primary-color);font-size:16px;margin:0}"]})}}return r})()}}]);