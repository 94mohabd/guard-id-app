import{a as D}from"./chunk-AXO2SKNZ.js";import{a as L,e as T,f as N}from"./chunk-UQMFK6TD.js";import{Ba as F,Ea as C,La as p,M as O,Oa as l,Pa as s,Qa as m,R as k,Ra as w,Sa as I,Ta as f,Ua as V,Va as E,Wa as R,Xa as c,Y as v,Z as _,Za as b,c as S,n as y,qa as P,r as M,rb as j,sa as d,wa as x,y as U}from"./chunk-5MQG5VT3.js";var z=(()=>{class i{constructor(t){this.http=t,this.apiBaseUrl="https://guardid-dugdbpembqa0ega6.centralus-01.azurewebsites.net/api/Detection"}uploadVerificationImages(t,r,e){let n=new FormData;return n.append("frontId",t),n.append("backId",r),n.append("selfie",e),this.http.post(`${this.apiBaseUrl}/verify-id`,n).pipe(M(a=>({success:!0,message:"Upload successful",result:a})),U(a=>{let o={errorCode:"UNKNOWN_ERROR",message:"An unknown error occurred.",details:""};return a.error&&(o={errorCode:a.error.errorCode||"UNKNOWN_ERROR",message:a.error.message||"An error occurred.",details:a.error.details||""}),y(()=>({success:!1,message:o.message,error:o}))}))}static{this.\u0275fac=function(r){return new(r||i)(k(L))}}static{this.\u0275prov=O({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var q=["fileInput"];function B(i,u){i&1&&(l(0,"div",12)(1,"span",13),c(2,"face"),s(),l(3,"div",14),m(4,"div",15)(5,"div",15)(6,"div",15)(7,"div",15),s()())}function K(i,u){i&1&&(l(0,"div",16),c(1," Checking Image, please wait... "),m(2,"div",17),s())}function W(i,u){if(i&1&&(l(0,"div",18)(1,"strong"),c(2,"Error: "),s(),c(3),s()),i&2){let t=f();d(3),b("",t.errorMessage," ")}}function H(i,u){if(i&1&&m(0,"img",19),i&2){let t=f();p("src",t.previewUrl,P)}}function J(i,u){if(i&1){let t=w();l(0,"div",20)(1,"button",21),I("click",function(){v(t);let e=f();return _(e.uploadPhoto())}),c(2),s()()}if(i&2){let t=f();d(),p("disabled",t.isUploading),d(),b(" ",t.isUploading?"Uploading...":"Complete Verification"," ")}}var te=(()=>{class i{constructor(t,r,e){this.imageVerificationService=t,this.uploadService=r,this.router=e,this.selectedFile=null,this.previewUrl=null,this.isLoading=!1,this.isUploading=!1,this.errorMessage=null,this.isValidated=!1}ngOnInit(){let t=localStorage.getItem("selfie");t&&(this.previewUrl=t,this.selectedFile=null,this.isValidated=!0)}triggerFileInput(){this.fileInput.nativeElement.click()}onFileSelected(t){return S(this,null,function*(){let r=t.target;if(r.files&&r.files.length>0){this.selectedFile=r.files[0],this.errorMessage=null,this.isLoading=!0,this.isValidated=!1,this.previewUrl=null;try{let e=yield this.imageVerificationService.processSelfieImage(this.selectedFile);e.success?(this.previewUrl=e.previewUrl,this.selectedFile=e.resizedImage,this.isValidated=!0,localStorage.setItem("selfie",e.previewUrl)):(localStorage.removeItem("selfie"),this.errorMessage=e.message)}catch{this.errorMessage="Error processing image. Please try again."}finally{this.isLoading=!1}}})}uploadPhoto(){if(this.isValidated&&!this.errorMessage){this.isUploading=!0,this.errorMessage=null;let t=localStorage.getItem("frontId"),r=localStorage.getItem("backId"),e=localStorage.getItem("selfie");if(!t||!r||!e){this.errorMessage="Missing ID images. Please upload them again.",this.isUploading=!1;return}let n=this.dataURLtoFile(t,"frontId.jpg"),a=this.dataURLtoFile(r,"backId.jpg"),o=this.dataURLtoFile(e,"selfie.jpg"),h=this.uploadService.uploadVerificationImages(n,a,o).subscribe({next:g=>{g.success?(localStorage.setItem("verificationResult",JSON.stringify(g.result)),this.router.navigate(["/verification-result"])):this.errorMessage=g.message},error:g=>{this.errorMessage=g.message||"Error uploading images"},complete:()=>{this.isUploading=!1,h.unsubscribe()}})}}dataURLtoFile(t,r){let e=t.split(","),n=e[0].match(/:(.*?);/)?.[1],a=atob(e[1]),o=a.length,h=new Uint8Array(o);for(;o--;)h[o]=a.charCodeAt(o);return new File([h],r,{type:n})}static{this.\u0275fac=function(r){return new(r||i)(x(D),x(z),x(T))}}static{this.\u0275cmp=F({type:i,selectors:[["app-selfie"]],viewQuery:function(r,e){if(r&1&&V(q,5),r&2){let n;E(n=R())&&(e.fileInput=n.first)}},decls:19,vars:5,consts:[["fileInput",""],[1,"container","screen-enter"],[1,"header"],["routerLink","/id-upload-back",1,"back-button"],[1,"content"],[1,"upload-area",3,"click"],["class","selfie-placeholder",4,"ngIf"],["class","loading-message",4,"ngIf"],["class","error-message",4,"ngIf"],["alt","Selfie preview","class","preview-image",3,"src",4,"ngIf"],["type","file","accept","image/*",2,"display","none",3,"change"],["class","footer",4,"ngIf"],[1,"selfie-placeholder"],[1,"material-icons"],[1,"placeholder-lines"],[1,"line"],[1,"loading-message"],[1,"spinner"],[1,"error-message"],["alt","Selfie preview",1,"preview-image",3,"src"],[1,"footer"],[1,"primary-button",3,"click","disabled"]],template:function(r,e){if(r&1){let n=w();l(0,"div",1)(1,"div",2)(2,"a",3),c(3,"\u2190"),s()(),l(4,"div",4)(5,"h2"),c(6,"Take a Selfie"),s(),l(7,"p"),c(8,"Make sure you're well-lit"),m(9,"br"),c(10,"and facing the camera."),s(),l(11,"div",5),I("click",function(){return v(n),_(e.triggerFileInput())}),C(12,B,8,0,"div",6)(13,K,3,0,"div",7)(14,W,4,1,"div",8)(15,H,1,1,"img",9),l(16,"input",10,0),I("change",function(o){return v(n),_(e.onFileSelected(o))}),s()()(),C(18,J,3,2,"div",11),s()}r&2&&(d(12),p("ngIf",!e.selectedFile&&!e.previewUrl),d(),p("ngIf",e.isLoading),d(),p("ngIf",e.errorMessage),d(),p("ngIf",e.previewUrl),d(3),p("ngIf",e.isValidated&&!e.errorMessage))},dependencies:[N,j],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;padding:var(--spacing-lg)}.header[_ngcontent-%COMP%]{padding:var(--spacing-md) 0}.content[_ngcontent-%COMP%]{flex-grow:1;display:flex;flex-direction:column;align-items:center;padding-top:var(--spacing-xl);text-align:center}h2[_ngcontent-%COMP%]{font-size:24px;margin-bottom:var(--spacing-md)}p[_ngcontent-%COMP%]{color:#666;margin-bottom:var(--spacing-xl)}.upload-area[_ngcontent-%COMP%]{border:2px dashed var(--border-color);border-radius:var(--border-radius-md);padding:var(--spacing-xl);width:100%;height:200px;display:flex;align-items:center;justify-content:center;margin:var(--spacing-lg) 0;cursor:pointer;position:relative}.selfie-placeholder[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;color:#aaa}.selfie-placeholder[_ngcontent-%COMP%]   .material-icons[_ngcontent-%COMP%]{font-size:48px;margin-bottom:var(--spacing-md)}.placeholder-lines[_ngcontent-%COMP%]{width:120px}.line[_ngcontent-%COMP%]{height:8px;background-color:var(--medium-gray);margin-bottom:8px;border-radius:4px}.loading-message[_ngcontent-%COMP%]{color:var(--primary-color);text-align:center}.spinner[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid var(--primary-color);border-top-color:transparent;border-radius:50%;margin:10px auto;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-message[_ngcontent-%COMP%]{color:#dc3545;text-align:center;margin-top:var(--spacing-md)}.preview-image[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain}.footer[_ngcontent-%COMP%]{padding:var(--spacing-lg) 0}.primary-button[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}"]})}}return i})();export{te as SelfieComponent};
