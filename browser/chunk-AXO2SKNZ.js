import{a as f}from"./chunk-UQMFK6TD.js";import{M as h,R as w,c as o,q as u}from"./chunk-5MQG5VT3.js";var y=(()=>{class m{constructor(r){this.http=r,this.apiBaseUrl="https://guardid-dugdbpembqa0ega6.centralus-01.azurewebsites.net/api/Detection"}resizeImageTo1MB(r){return o(this,null,function*(){return r.size<=1048576?r:new Promise((t,s)=>{let c=new FileReader;c.onload=I=>{let n=new Image;n.onload=()=>{let g=document.createElement("canvas"),p=g.getContext("2d");if(!p){s(new Error("Could not get canvas context"));return}let a=n.width,i=n.height;a>i?a>1024&&(i=Math.round(i*=1024/a),a=1024):i>1024&&(a=Math.round(a*=1024/i),i=1024),g.width=a,g.height=i,p.drawImage(n,0,0,a,i),g.toBlob(d=>{if(!d){s(new Error("Could not create blob"));return}if(d.size>1048576){let l=new File([d],r.name,{type:"image/jpeg"});this.resizeImageTo1MB(l).then(t).catch(s)}else{let l=new File([d],r.name,{type:"image/jpeg",lastModified:r.lastModified});t(l)}},"image/jpeg",.7)},n.onerror=()=>s(new Error("Error loading image")),n.src=I.target?.result},c.onerror=()=>s(new Error("Error reading file")),c.readAsDataURL(r)})})}detectFaceInImage(r){return o(this,null,function*(){let e=new FormData;e.append("imageFile",r);try{return yield u(this.http.post(`${this.apiBaseUrl}/detect-face`,e))}catch(t){throw this.parseErrorResponse(t)}})}detectTextInImage(r){return o(this,null,function*(){let e=new FormData;e.append("imageFile",r);try{return yield u(this.http.post(`${this.apiBaseUrl}/detect-text`,e))}catch(t){throw this.parseErrorResponse(t)}})}detectBarcodeInImage(r){return o(this,null,function*(){let e=new FormData;e.append("imageFile",r);try{return yield u(this.http.post(`${this.apiBaseUrl}/detect-barcode`,e))}catch(t){throw this.parseErrorResponse(t)}})}processFrontIdImage(r){return o(this,null,function*(){try{let e=yield this.resizeImageTo1MB(r),t=yield this.detectFaceInImage(e),s=yield this.detectTextInImage(e);if(!t.success)return{success:!1,message:t.message};if(!s.success)return{success:!1,message:s.message};let c=yield this.createPreviewUrl(e);return{success:!0,resizedImage:e,previewUrl:c}}catch(e){return{success:!1,message:e.message||"Error processing image"}}})}processBackIdImage(r){return o(this,null,function*(){try{let e=yield this.resizeImageTo1MB(r),t=yield this.detectBarcodeInImage(e);if(!t.success)return{success:!1,message:t.message};let s=yield this.createPreviewUrl(e);return{success:!0,resizedImage:e,previewUrl:s}}catch(e){return{success:!1,message:e.message||"Error processing image"}}})}processSelfieImage(r){return o(this,null,function*(){try{let e=yield this.resizeImageTo1MB(r),t=yield this.detectFaceInImage(e);if(!t.success)return{success:!1,message:t.message};let s=yield this.createPreviewUrl(e);return{success:!0,resizedImage:e,previewUrl:s}}catch(e){return{success:!1,message:e.message||"Error processing image"}}})}createPreviewUrl(r){return new Promise((e,t)=>{let s=new FileReader;s.onload=c=>e(c.target?.result),s.onerror=()=>t(new Error("Error creating preview")),s.readAsDataURL(r)})}parseErrorResponse(r){let e={errorCode:"UNKNOWN_ERROR",message:"An unknown error occurred.",details:""};return r?.error&&(e={errorCode:r.error.errorCode||"UNKNOWN_ERROR",message:r.error.message||"An error occurred.",details:r.error.details||""}),e}static{this.\u0275fac=function(e){return new(e||m)(w(f))}}static{this.\u0275prov=h({token:m,factory:m.\u0275fac,providedIn:"root"})}}return m})();export{y as a};
